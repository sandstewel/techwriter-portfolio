<div class="swagger-container">
  <div id="swagger-ui"></div>
</div>

<script src="https://unpkg.com/swagger-ui-dist/swagger-ui-bundle.js"></script>
<script src="https://unpkg.com/swagger-ui-dist/swagger-ui-standalone-preset.js"></script>

<script>
window.onload = function() {
  const specUrl = '{{ .Get "spec" | default "openapi.yaml" | relURL }}';
  const ui = SwaggerUIBundle({
    url: specUrl,
    dom_id: '#swagger-ui',
    presets: [
      SwaggerUIBundle.presets.apis,
      SwaggerUIStandalonePreset
    ],
    layout: "StandaloneLayout",
    docExpansion: "none"
  });
  window.ui = ui;

  // Bind copy buttons after a short delay to ensure UI is rendered
  setTimeout(() => {
    document.querySelectorAll('.btn-clipboard').forEach(button => {
      button.addEventListener('click', async () => {
        const codeBlock = button.closest('.highlight') || button.closest('pre');
        if (!codeBlock) return;
        try {
          const text = codeBlock.innerText || codeBlock.textContent;
          await navigator.clipboard.writeText(text.trim());
          button.innerText = 'Copied!';
          setTimeout(() => (button.innerText = 'Copy'), 2000);
        } catch (err) {
          console.error('Copy failed:', err);
          button.innerText = 'Failed';
        }
      });
    });
  }, 1000);
};
</script>
